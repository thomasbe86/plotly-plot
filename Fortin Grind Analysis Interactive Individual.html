<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RhPf Electronics Fortin Grind Analysis Interactive Individual</title>
    <meta name="description" content="Interactive analysis tool for the Fortin Grind.">
    <meta name="author" content="RhPf Electronics">
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script>
        if (!window.Plotly) {
            document.write('<script src="/path-to-local-plotly/plotly-latest.min.js"><\/script>');
        }
    </script>
    <style>
        body {
            display: flex;
            flex-direction: row; /* Stack pedal and graph horizontally */
            justify-content: left;
            align-items: top;
            margin: 0;
            height: auto;
        }

        #pedal-container {
            width: 100%; /* Scale pedal container to fit the viewport */
            height: 100vh; /* Maintain aspect ratio */
            margin: 0;
        }

        #pedal-svg {
            width: 100%; /* Make the SVG scale with the container */
            height: 100vh; /* Maintain aspect ratio */
            margin: 0;
        }

        #graph {
            width: 100%; /* Take up most of the width */
            height: 100vh; /* Dynamically scale height relative to the viewport */
            margin: 0; /* Add some spacing between graph and pedal */
        }

    </style>
</head>
<body>
    <!-- Pedal with Knobs -->
    <div id="pedal-container">
        <svg id="pedal-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1884 3600">
            <!-- Background Image -->
            <image href="https://thomasbe86.github.io/plotly-plot/Fortin%20Grind.png" x="0" y="0" width="1884" height="3600" />
<g id="knob-Level" transform="translate(910, 1280)">
    <circle cx="0" cy="0" r="350" fill="#000" stroke="none" stroke-width="3" />
    <line id="Level-pointer" x1="0" y1="0" x2="0" y2="-250" stroke="#FFFFFF" stroke-width="15" stroke-linecap="round" />
</g>
        </svg>
    </div>

    <!-- Graph -->
    <div id="graph"></div>

    <script>
        // Ensure Plotly resizes with window changes
        window.addEventListener('resize', () => {
            Plotly.Plots.resize(document.getElementById('graph'));
        });
    </script>

    <script>
        // Frequency Data
        const frequency = [
            20, 21.44, 22.97, 24.62, 26.39, 28.28, 30.31, 32.49, 34.82, 37.32, 40,
            42.87, 45.95, 49.25, 52.78, 56.57, 60.63, 64.98, 69.64, 74.64, 80,
            85.74, 91.89, 98.49, 105.56, 113.13, 121.25, 129.96, 139.28, 149.29, 160,
            171.48, 183.79, 196.98, 211.12, 226.27, 242.51, 259.92, 278.58, 298.57,
            320, 342.97, 367.58, 393.97, 422.24, 452.55, 485.03, 519.84, 557.15,
            597.14, 640, 685.93, 735.17, 787.93, 844.49, 905.1, 970.06, 1039.68,
            1114.3, 1194.28, 1280, 1371.87, 1470.33, 1575.86, 1688.97, 1810.19,
            1940.12, 2079.37, 2228.61, 2388.56, 2560, 2743.74, 2940.67, 3151.73,
            3377.94, 3620.39, 3880.23, 4158.73, 4457.22, 4777.13, 5120, 5487.48,
            5881.34, 6303.46, 6755.88, 7240.77, 7760.47, 8317.46, 8914.44, 9554.26,
            10240, 10974.96, 11762.67, 12606.92, 13511.76, 14481.55, 15520.94,
            16634.93, 17828.88, 19108.52
        ];

        const LevelPositions = {
            0: [0.0921, 0.0924, 0.0927, 0.0931, 0.0936, 0.0941, 0.0948, 0.0955, 0.0963, 0.0972, 0.0982, 0.0994, 0.1007, 0.1022, 0.1038, 0.1056, 0.1077, 0.11, 0.1125, 0.1153, 0.1183, 0.1217, 0.1254, 0.1294, 0.1339, 0.1387, 0.144, 0.1497, 0.156, 0.1629, 0.1703, 0.1785, 0.1875, 0.1973, 0.2082, 0.2201, 0.2333, 0.2478, 0.2639, 0.2817, 0.3015, 0.3233, 0.3475, 0.374, 0.4031, 0.4346, 0.4684, 0.5039, 0.5402, 0.5758, 0.6094, 0.6387, 0.662, 0.6784, 0.687, 0.6885, 0.684, 0.675, 0.6629, 0.6492, 0.6347, 0.6204, 0.6066, 0.5937, 0.5819, 0.5711, 0.5613, 0.5527, 0.545, 0.5381, 0.5321, 0.5267, 0.522, 0.5179, 0.5143, 0.5111, 0.5083, 0.5058, 0.5036, 0.5017, 0.4999, 0.4984, 0.497, 0.4957, 0.4946, 0.4935, 0.4925, 0.4915, 0.4905, 0.4895, 0.4886, 0.4876, 0.4865, 0.4854, 0.4842, 0.4829, 0.4814, 0.4798, 0.478, 0.476],
            5: [0.0983, 0.0987, 0.099, 0.0995, 0.1, 0.1006, 0.1012, 0.102, 0.1028, 0.1038, 0.1049, 0.1061, 0.1075, 0.1091, 0.1109, 0.1128, 0.115, 0.1175, 0.1201, 0.1231, 0.1264, 0.13, 0.1339, 0.1383, 0.143, 0.1481, 0.1538, 0.1599, 0.1666, 0.1739, 0.1819, 0.1907, 0.2003, 0.2108, 0.2223, 0.2351, 0.2491, 0.2647, 0.2819, 0.3009, 0.322, 0.3453, 0.3711, 0.3995, 0.4305, 0.4642, 0.5003, 0.5382, 0.5769, 0.615, 0.6508, 0.6821, 0.7071, 0.7245, 0.7338, 0.7354, 0.7306, 0.7209, 0.708, 0.6933, 0.6779, 0.6626, 0.6479, 0.6341, 0.6215, 0.6099, 0.5996, 0.5903, 0.5821, 0.5748, 0.5683, 0.5626, 0.5576, 0.5532, 0.5493, 0.5459, 0.5429, 0.5402, 0.5379, 0.5358, 0.534, 0.5323, 0.5308, 0.5295, 0.5282, 0.5271, 0.526, 0.5249, 0.5239, 0.5229, 0.5218, 0.5208, 0.5196, 0.5185, 0.5172, 0.5158, 0.5142, 0.5125, 0.5106, 0.5084],
            10: [0.1063, 0.1066, 0.107, 0.1075, 0.108, 0.1087, 0.1094, 0.1102, 0.1111, 0.1122, 0.1133, 0.1147, 0.1162, 0.1179, 0.1198, 0.1219, 0.1243, 0.1269, 0.1298, 0.133, 0.1366, 0.1405, 0.1447, 0.1494, 0.1545, 0.1601, 0.1662, 0.1728, 0.18, 0.1879, 0.1966, 0.206, 0.2164, 0.2277, 0.2402, 0.254, 0.2692, 0.286, 0.3046, 0.3251, 0.3479, 0.3731, 0.401, 0.4316, 0.4652, 0.5016, 0.5406, 0.5815, 0.6234, 0.6645, 0.7032, 0.737, 0.764, 0.7829, 0.7929, 0.7946, 0.7894, 0.779, 0.765, 0.7492, 0.7325, 0.7159, 0.7, 0.6852, 0.6715, 0.659, 0.6478, 0.6378, 0.6289, 0.621, 0.6141, 0.6079, 0.6025, 0.5977, 0.5935, 0.5899, 0.5866, 0.5837, 0.5812, 0.579, 0.577, 0.5752, 0.5736, 0.5721, 0.5708, 0.5695, 0.5683, 0.5672, 0.5661, 0.565, 0.5639, 0.5627, 0.5615, 0.5602, 0.5588, 0.5573, 0.5556, 0.5538, 0.5517, 0.5494],
            15: [0.1171, 0.1175, 0.1179, 0.1185, 0.1191, 0.1197, 0.1205, 0.1214, 0.1225, 0.1236, 0.1249, 0.1264, 0.128, 0.1299, 0.132, 0.1343, 0.137, 0.1399, 0.143, 0.1466, 0.1505, 0.1548, 0.1595, 0.1646, 0.1703, 0.1764, 0.1831, 0.1904, 0.1984, 0.2071, 0.2166, 0.227, 0.2384, 0.251, 0.2647, 0.2799, 0.2966, 0.3151, 0.3356, 0.3583, 0.3834, 0.4112, 0.4419, 0.4756, 0.5126, 0.5527, 0.5957, 0.6408, 0.6869, 0.7323, 0.7749, 0.8122, 0.8419, 0.8627, 0.8737, 0.8756, 0.8699, 0.8584, 0.843, 0.8255, 0.8072, 0.7889, 0.7714, 0.755, 0.74, 0.7262, 0.7139, 0.7029, 0.693, 0.6843, 0.6767, 0.6698, 0.6639, 0.6586, 0.6541, 0.65, 0.6464, 0.6433, 0.6404, 0.638, 0.6358, 0.6339, 0.632, 0.6304, 0.629, 0.6276, 0.6263, 0.625, 0.6238, 0.6226, 0.6214, 0.6201, 0.6187, 0.6174, 0.6158, 0.6141, 0.6123, 0.6102, 0.6079, 0.6054],
            20: [0.1325, 0.1329, 0.1335, 0.1341, 0.1347, 0.1355, 0.1364, 0.1374, 0.1386, 0.1399, 0.1414, 0.143, 0.1449, 0.147, 0.1494, 0.152, 0.155, 0.1583, 0.1619, 0.1659, 0.1703, 0.1752, 0.1805, 0.1863, 0.1927, 0.1996, 0.2072, 0.2155, 0.2245, 0.2344, 0.2451, 0.2569, 0.2698, 0.284, 0.2996, 0.3167, 0.3357, 0.3566, 0.3798, 0.4054, 0.4339, 0.4653, 0.5, 0.5383, 0.5801, 0.6255, 0.6741, 0.7251, 0.7774, 0.8287, 0.877, 0.9191, 0.9528, 0.9763, 0.9888, 0.9909, 0.9845, 0.9714, 0.9541, 0.9343, 0.9135, 0.8928, 0.873, 0.8545, 0.8374, 0.8219, 0.8079, 0.7954, 0.7843, 0.7745, 0.7658, 0.758, 0.7513, 0.7454, 0.7402, 0.7356, 0.7316, 0.728, 0.7248, 0.722, 0.7195, 0.7173, 0.7153, 0.7134, 0.7118, 0.7102, 0.7087, 0.7073, 0.7059, 0.7045, 0.7032, 0.7018, 0.7002, 0.6986, 0.6969, 0.695, 0.6929, 0.6906, 0.688, 0.6851],
            25: [0.1542, 0.1547, 0.1553, 0.156, 0.1568, 0.1577, 0.1587, 0.1599, 0.1612, 0.1627, 0.1645, 0.1664, 0.1686, 0.1711, 0.1738, 0.1769, 0.1803, 0.1842, 0.1883, 0.193, 0.1982, 0.2038, 0.21, 0.2168, 0.2242, 0.2323, 0.2411, 0.2507, 0.2612, 0.2727, 0.2852, 0.299, 0.314, 0.3304, 0.3486, 0.3685, 0.3906, 0.415, 0.4419, 0.4717, 0.5048, 0.5414, 0.5818, 0.6263, 0.675, 0.7278, 0.7843, 0.8437, 0.9045, 0.9642, 1.0204, 1.0694, 1.1086, 1.1359, 1.1504, 1.1529, 1.1454, 1.1303, 1.1101, 1.087, 1.0629, 1.0388, 1.0158, 0.9942, 0.9743, 0.9563, 0.94, 0.9255, 0.9126, 0.9011, 0.891, 0.882, 0.8742, 0.8672, 0.8612, 0.8559, 0.8512, 0.847, 0.8433, 0.8401, 0.8372, 0.8346, 0.8322, 0.8301, 0.8282, 0.8263, 0.8246, 0.823, 0.8214, 0.8198, 0.8181, 0.8165, 0.8147, 0.8129, 0.8108, 0.8086, 0.8062, 0.8035, 0.8005, 0.7971],
            30: [0.1875, 0.1881, 0.1889, 0.1897, 0.1907, 0.1917, 0.193, 0.1944, 0.1961, 0.1979, 0.2, 0.2024, 0.2051, 0.208, 0.2114, 0.2151, 0.2193, 0.224, 0.2291, 0.2348, 0.241, 0.2479, 0.2554, 0.2636, 0.2727, 0.2825, 0.2933, 0.305, 0.3177, 0.3317, 0.3469, 0.3636, 0.3818, 0.4019, 0.424, 0.4482, 0.4751, 0.5047, 0.5375, 0.5737, 0.6139, 0.6584, 0.7076, 0.7617, 0.8209, 0.8852, 0.9539, 1.0261, 1.1001, 1.1727, 1.241, 1.3007, 1.3483, 1.3815, 1.3992, 1.4022, 1.3931, 1.3746, 1.3501, 1.322, 1.2927, 1.2634, 1.2354, 1.2091, 1.185, 1.163, 1.1432, 1.1256, 1.1099, 1.0959, 1.0836, 1.0727, 1.0632, 1.0548, 1.0474, 1.0409, 1.0352, 1.0301, 1.0256, 1.0217, 1.0182, 1.0151, 1.0122, 1.0096, 1.0072, 1.005, 1.0029, 1.0009, 0.999, 0.997, 0.995, 0.9931, 0.9909, 0.9886, 0.9861, 0.9834, 0.9805, 0.9772, 0.9736, 0.9695],
            35: [0.2334, 0.2341, 0.235, 0.2361, 0.2373, 0.2386, 0.2402, 0.242, 0.244, 0.2463, 0.2489, 0.2519, 0.2552, 0.2589, 0.2631, 0.2677, 0.273, 0.2787, 0.2851, 0.2921, 0.2999, 0.3084, 0.3178, 0.3281, 0.3393, 0.3515, 0.3649, 0.3795, 0.3954, 0.4127, 0.4317, 0.4525, 0.4752, 0.5001, 0.5276, 0.5578, 0.5912, 0.628, 0.6689, 0.714, 0.764, 0.8194, 0.8806, 0.9479, 1.0216, 1.1016, 1.1871, 1.277, 1.369, 1.4594, 1.5443, 1.6186, 1.6779, 1.7192, 1.7412, 1.745, 1.7336, 1.7107, 1.6801, 1.6452, 1.6087, 1.5723, 1.5374, 1.5047, 1.4747, 1.4473, 1.4227, 1.4007, 1.3812, 1.3638, 1.3485, 1.3349, 1.3231, 1.3126, 1.3035, 1.2954, 1.2883, 1.282, 1.2763, 1.2715, 1.267, 1.2632, 1.2596, 1.2564, 1.2535, 1.2507, 1.2481, 1.2456, 1.2431, 1.2407, 1.2383, 1.2358, 1.2331, 1.2303, 1.2272, 1.2238, 1.2202, 1.2161, 1.2116, 1.2065],
            40: [0.2917, 0.2927, 0.2938, 0.2951, 0.2966, 0.2983, 0.3002, 0.3025, 0.305, 0.3079, 0.3112, 0.3148, 0.319, 0.3236, 0.3288, 0.3347, 0.3412, 0.3484, 0.3563, 0.3652, 0.3749, 0.3856, 0.3973, 0.4101, 0.4242, 0.4394, 0.4562, 0.4744, 0.4942, 0.5159, 0.5396, 0.5656, 0.594, 0.6252, 0.6595, 0.6972, 0.739, 0.7851, 0.8361, 0.8925, 0.955, 1.0242, 1.1007, 1.1849, 1.277, 1.3769, 1.4839, 1.5962, 1.7112, 1.8242, 1.9304, 2.0233, 2.0974, 2.149, 2.1765, 2.1812, 2.1671, 2.1383, 2.1001, 2.0565, 2.0108, 1.9653, 1.9217, 1.8809, 1.8433, 1.8091, 1.7783, 1.7509, 1.7264, 1.7048, 1.6857, 1.6686, 1.6539, 1.6407, 1.6293, 1.6192, 1.6103, 1.6024, 1.5954, 1.5893, 1.5838, 1.579, 1.5745, 1.5705, 1.5668, 1.5633, 1.5601, 1.557, 1.5539, 1.5509, 1.5478, 1.5448, 1.5413, 1.5379, 1.534, 1.5298, 1.5252, 1.5201, 1.5144, 1.5081],
            45: [0.3667, 0.3679, 0.3693, 0.371, 0.3729, 0.375, 0.3775, 0.3802, 0.3835, 0.3871, 0.3912, 0.3958, 0.401, 0.4068, 0.4134, 0.4207, 0.4289, 0.438, 0.448, 0.4591, 0.4713, 0.4847, 0.4995, 0.5156, 0.5332, 0.5524, 0.5735, 0.5964, 0.6213, 0.6486, 0.6784, 0.711, 0.7467, 0.7859, 0.8291, 0.8765, 0.929, 0.9869, 1.0511, 1.122, 1.2006, 1.2876, 1.3838, 1.4895, 1.6053, 1.731, 1.8655, 2.0067, 2.1512, 2.2933, 2.4268, 2.5435, 2.6367, 2.7017, 2.7362, 2.7421, 2.7243, 2.6882, 2.6401, 2.5853, 2.5279, 2.4707, 2.4159, 2.3645, 2.3173, 2.2744, 2.2356, 2.2012, 2.1704, 2.1431, 2.1191, 2.0977, 2.0791, 2.0626, 2.0483, 2.0356, 2.0244, 2.0145, 2.0056, 1.998, 1.9911, 1.985, 1.9793, 1.9743, 1.9697, 1.9653, 1.9613, 1.9574, 1.9535, 1.9497, 1.9459, 1.942, 1.9377, 1.9333, 1.9284, 1.9232, 1.9174, 1.911, 1.9039, 1.8959],
            50: [0.4667, 0.4683, 0.4701, 0.4722, 0.4746, 0.4772, 0.4804, 0.4839, 0.4881, 0.4926, 0.4979, 0.5037, 0.5104, 0.5178, 0.5262, 0.5354, 0.5459, 0.5575, 0.5701, 0.5843, 0.5999, 0.6169, 0.6357, 0.6562, 0.6787, 0.7031, 0.7299, 0.759, 0.7908, 0.8255, 0.8634, 0.9049, 0.9504, 1.0003, 1.0552, 1.1156, 1.1824, 1.2561, 1.3378, 1.428, 1.5281, 1.6388, 1.7612, 1.8958, 2.0432, 2.2031, 2.3743, 2.554, 2.7379, 2.9188, 3.0887, 3.2372, 3.3558, 3.4385, 3.4824, 3.49, 3.4673, 3.4214, 3.3602, 3.2905, 3.2174, 3.1445, 3.0747, 3.0094, 2.9493, 2.8947, 2.8454, 2.8015, 2.7623, 2.7277, 2.6971, 2.6699, 2.6462, 2.6252, 2.6069, 2.5908, 2.5766, 2.5639, 2.5527, 2.5429, 2.5341, 2.5264, 2.5192, 2.5128, 2.5069, 2.5014, 2.4962, 2.4912, 2.4863, 2.4814, 2.4766, 2.4716, 2.4661, 2.4606, 2.4544, 2.4477, 2.4403, 2.4322, 2.4231, 2.413],
            55: [0.5834, 0.5853, 0.5876, 0.5902, 0.5932, 0.5965, 0.6005, 0.6049, 0.6101, 0.6158, 0.6223, 0.6297, 0.6379, 0.6472, 0.6577, 0.6693, 0.6824, 0.6968, 0.7127, 0.7304, 0.7498, 0.7711, 0.7946, 0.8202, 0.8483, 0.8789, 0.9124, 0.9488, 0.9885, 1.0318, 1.0793, 1.1312, 1.188, 1.2503, 1.319, 1.3945, 1.4779, 1.5701, 1.6722, 1.7849, 1.91, 2.0484, 2.2015, 2.3697, 2.5539, 2.7539, 2.9678, 3.1924, 3.4224, 3.6484, 3.8608, 4.0465, 4.1947, 4.2981, 4.353, 4.3625, 4.3341, 4.2767, 4.2002, 4.113, 4.0217, 3.9306, 3.8434, 3.7617, 3.6866, 3.6183, 3.5567, 3.5018, 3.4529, 3.4095, 3.3713, 3.3373, 3.3077, 3.2814, 3.2586, 3.2384, 3.2207, 3.2049, 3.1908, 3.1786, 3.1676, 3.158, 3.1489, 3.1409, 3.1336, 3.1267, 3.1202, 3.114, 3.1078, 3.1018, 3.0957, 3.0895, 3.0826, 3.0758, 3.0679, 3.0595, 3.0504, 3.0402, 3.0289, 3.0162],
            60: [0.7376, 0.74, 0.7429, 0.7462, 0.7499, 0.7542, 0.7592, 0.7648, 0.7713, 0.7785, 0.7868, 0.7961, 0.8065, 0.8183, 0.8315, 0.8462, 0.8627, 0.881, 0.901, 0.9234, 0.948, 0.9749, 1.0046, 1.037, 1.0725, 1.1111, 1.1535, 1.1995, 1.2497, 1.3045, 1.3645, 1.4301, 1.5019, 1.5808, 1.6675, 1.763, 1.8685, 1.985, 2.1142, 2.2567, 2.4148, 2.5898, 2.7833, 2.996, 3.2289, 3.4817, 3.7521, 4.0361, 4.3269, 4.6126, 4.8812, 5.1159, 5.3033, 5.434, 5.5034, 5.5154, 5.4795, 5.4069, 5.3102, 5.2, 5.0845, 4.9694, 4.8591, 4.7559, 4.6609, 4.5745, 4.4966, 4.4273, 4.3654, 4.3106, 4.2623, 4.2192, 4.1819, 4.1487, 4.1198, 4.0943, 4.0718, 4.0518, 4.034, 4.0187, 4.0047, 3.9926, 3.9811, 3.971, 3.9618, 3.953, 3.9448, 3.9369, 3.9292, 3.9215, 3.9138, 3.906, 3.8973, 3.8886, 3.8787, 3.8681, 3.8565, 3.8437, 3.8294, 3.8133],
            65: [0.921, 0.924, 0.9275, 0.9317, 0.9364, 0.9417, 0.9479, 0.9549, 0.9631, 0.9721, 0.9824, 0.994, 1.0071, 1.0217, 1.0382, 1.0566, 1.0772, 1.1, 1.125, 1.1529, 1.1837, 1.2173, 1.2544, 1.2947, 1.3391, 1.3873, 1.4402, 1.4977, 1.5604, 1.6288, 1.7037, 1.7857, 1.8753, 1.9738, 2.0821, 2.2013, 2.333, 2.4785, 2.6398, 2.8177, 3.0152, 3.2336, 3.4752, 3.7408, 4.0316, 4.3472, 4.6849, 5.0395, 5.4025, 5.7593, 6.0947, 6.3878, 6.6217, 6.7849, 6.8716, 6.8865, 6.8417, 6.7511, 6.6304, 6.4928, 6.3486, 6.2048, 6.0671, 5.9382, 5.8196, 5.7118, 5.6145, 5.5279, 5.4507, 5.3822, 5.3219, 5.2682, 5.2215, 5.18, 5.144, 5.1121, 5.0841, 5.0591, 5.0369, 5.0177, 5.0003, 4.9851, 4.9708, 4.9582, 4.9467, 4.9357, 4.9255, 4.9157, 4.906, 4.8964, 4.8868, 4.8771, 4.8662, 4.8553, 4.843, 4.8298, 4.8153, 4.7993, 4.7814, 4.7613],
            70: [1.1377, 1.1414, 1.1458, 1.1509, 1.1567, 1.1632, 1.171, 1.1796, 1.1897, 1.2008, 1.2135, 1.2279, 1.244, 1.2621, 1.2825, 1.3052, 1.3307, 1.3588, 1.3897, 1.4242, 1.4622, 1.5037, 1.5495, 1.5994, 1.6542, 1.7138, 1.7791, 1.8501, 1.9275, 2.0121, 2.1046, 2.2058, 2.3166, 2.4382, 2.572, 2.7193, 2.882, 3.0617, 3.2609, 3.4807, 3.7246, 3.9945, 4.2929, 4.621, 4.9802, 5.3701, 5.7872, 6.2253, 6.6737, 7.1145, 7.5287, 7.8908, 8.1798, 8.3813, 8.4884, 8.5069, 8.4516, 8.3396, 8.1905, 8.0205, 7.8423, 7.6648, 7.4947, 7.3354, 7.189, 7.0557, 6.9356, 6.8286, 6.7332, 6.6487, 6.5741, 6.5078, 6.4501, 6.3989, 6.3544, 6.315, 6.2804, 6.2495, 6.2221, 6.1984, 6.1769, 6.1581, 6.1405, 6.1249, 6.1106, 6.0971, 6.0844, 6.0723, 6.0604, 6.0485, 6.0367, 6.0246, 6.0112, 5.9978, 5.9825, 5.9662, 5.9483, 5.9286, 5.9064, 5.8817],
            75: [1.4044, 1.4089, 1.4144, 1.4207, 1.4279, 1.436, 1.4455, 1.4561, 1.4686, 1.4823, 1.498, 1.5158, 1.5357, 1.558, 1.5832, 1.6111, 1.6426, 1.6774, 1.7155, 1.7581, 1.805, 1.8562, 1.9128, 1.9744, 2.042, 2.1156, 2.1962, 2.2838, 2.3794, 2.4838, 2.598, 2.7229, 2.8596, 3.0098, 3.175, 3.3568, 3.5577, 3.7795, 4.0254, 4.2967, 4.5978, 4.9309, 5.2993, 5.7043, 6.1477, 6.6291, 7.144, 7.6847, 8.2383, 8.7824, 9.2938, 9.7407, 10.0975, 10.3462, 10.4784, 10.5012, 10.4329, 10.2947, 10.1107, 9.9008, 9.6809, 9.4617, 9.2517, 9.0552, 8.8744, 8.7099, 8.5615, 8.4295, 8.3117, 8.2074, 8.1154, 8.0334, 7.9622, 7.899, 7.8441, 7.7955, 7.7527, 7.7147, 7.6808, 7.6515, 7.625, 7.6018, 7.58, 7.5608, 7.5432, 7.5265, 7.5108, 7.4959, 7.4812, 7.4665, 7.4519, 7.437, 7.4205, 7.4039, 7.385, 7.3649, 7.3428, 7.3184, 7.2911, 7.2605],
            80: [1.6044, 1.6096, 1.6158, 1.623, 1.6312, 1.6405, 1.6513, 1.6635, 1.6777, 1.6934, 1.7113, 1.7316, 1.7544, 1.7799, 1.8086, 1.8406, 1.8766, 1.9163, 1.9598, 2.0085, 2.062, 2.1206, 2.1852, 2.2555, 2.3328, 2.4168, 2.509, 2.6091, 2.7183, 2.8375, 2.968, 3.1107, 3.2669, 3.4384, 3.6271, 3.8348, 4.0643, 4.3178, 4.5986, 4.9085, 5.2526, 5.6331, 6.054, 6.5166, 7.0232, 7.5731, 8.1614, 8.7791, 9.4115, 10.0331, 10.6173, 11.1278, 11.5354, 11.8196, 11.9706, 11.9967, 11.9187, 11.7608, 11.5505, 11.3108, 11.0595, 10.8092, 10.5693, 10.3447, 10.1381, 9.9502, 9.7808, 9.63, 9.4954, 9.3762, 9.2711, 9.1774, 9.0961, 9.0239, 8.9612, 8.9056, 8.8568, 8.8133, 8.7746, 8.7411, 8.7109, 8.6844, 8.6595, 8.6375, 8.6174, 8.5983, 8.5804, 8.5634, 8.5465, 8.5298, 8.5131, 8.4961, 8.4772, 8.4583, 8.4367, 8.4137, 8.3885, 8.3606, 8.3294, 8.2945],
            85: [1.7794, 1.7852, 1.7921, 1.8001, 1.8092, 1.8194, 1.8315, 1.845, 1.8608, 1.8782, 1.8981, 1.9205, 1.9458, 1.9741, 2.0059, 2.0414, 2.0813, 2.1254, 2.1736, 2.2276, 2.287, 2.3519, 2.4236, 2.5016, 2.5874, 2.6805, 2.7827, 2.8937, 3.0148, 3.1471, 3.2918, 3.4501, 3.6233, 3.8135, 4.0229, 4.2532, 4.5077, 4.7888, 5.1003, 5.4441, 5.8257, 6.2477, 6.7145, 7.2276, 7.7895, 8.3994, 9.0518, 9.7369, 10.4384, 11.1277, 11.7757, 12.3419, 12.794, 13.1092, 13.2767, 13.3056, 13.2191, 13.0439, 12.8107, 12.5448, 12.2662, 11.9885, 11.7224, 11.4733, 11.2443, 11.0359, 10.8479, 10.6806, 10.5314, 10.3992, 10.2826, 10.1788, 10.0886, 10.0085, 9.9389, 9.8773, 9.8231, 9.7749, 9.732, 9.6949, 9.6613, 9.6319, 9.6043, 9.5799, 9.5576, 9.5364, 9.5166, 9.4977, 9.479, 9.4604, 9.4419, 9.4231, 9.4021, 9.3811, 9.3572, 9.3317, 9.3037, 9.2728, 9.2382, 9.1995],
            90: [1.9044, 1.9106, 1.918, 1.9265, 1.9363, 1.9473, 1.9602, 1.9746, 1.9915, 2.0101, 2.0314, 2.0555, 2.0825, 2.1128, 2.1469, 2.1848, 2.2275, 2.2747, 2.3263, 2.3841, 2.4477, 2.5172, 2.5938, 2.6774, 2.7691, 2.8688, 2.9782, 3.097, 3.2266, 3.3682, 3.523, 3.6925, 3.8779, 4.0815, 4.3055, 4.552, 4.8244, 5.1253, 5.4587, 5.8266, 6.235, 6.6867, 7.1862, 7.7354, 8.3367, 8.9895, 9.6877, 10.421, 11.1717, 11.9095, 12.603, 13.209, 13.6928, 14.0302, 14.2094, 14.2404, 14.1478, 13.9603, 13.7107, 13.4262, 13.1279, 12.8307, 12.546, 12.2794, 12.0342, 11.8112, 11.61, 11.431, 11.2712, 11.1297, 11.005, 10.8939, 10.7973, 10.7116, 10.6371, 10.5712, 10.5132, 10.4616, 10.4157, 10.376, 10.34, 10.3086, 10.279, 10.253, 10.229, 10.2064, 10.1852, 10.165, 10.145, 10.1251, 10.1052, 10.0851, 10.0627, 10.0402, 10.0146, 9.9873, 9.9574, 9.9243, 9.8872, 9.8458],
            95: [2.0086, 2.0151, 2.023, 2.0319, 2.0422, 2.0538, 2.0674, 2.0826, 2.1004, 2.1201, 2.1425, 2.1679, 2.1964, 2.2284, 2.2643, 2.3043, 2.3494, 2.3991, 2.4536, 2.5145, 2.5816, 2.6549, 2.7357, 2.8238, 2.9206, 3.0258, 3.1411, 3.2664, 3.4032, 3.5525, 3.7158, 3.8945, 4.09, 4.3047, 4.541, 4.8011, 5.0883, 5.4057, 5.7573, 6.1453, 6.576, 7.0525, 7.5793, 8.1586, 8.7928, 9.4813, 10.2177, 10.9911, 11.7829, 12.561, 13.2924, 13.9316, 14.4419, 14.7977, 14.9868, 15.0194, 14.9217, 14.724, 14.4608, 14.1606, 13.8461, 13.5326, 13.2323, 12.9511, 12.6926, 12.4573, 12.2452, 12.0563, 11.8878, 11.7386, 11.607, 11.4898, 11.388, 11.2976, 11.219, 11.1495, 11.0883, 11.0339, 10.9855, 10.9436, 10.9057, 10.8725, 10.8413, 10.8138, 10.7886, 10.7647, 10.7424, 10.721, 10.6999, 10.679, 10.6581, 10.6368, 10.6132, 10.5894, 10.5625, 10.5336, 10.5021, 10.4672, 10.4281, 10.3844],
            100: [2.1749, 2.182, 2.1904, 2.2001, 2.2113, 2.2238, 2.2386, 2.255, 2.2743, 2.2956, 2.3199, 2.3474, 2.3782, 2.4129, 2.4518, 2.4951, 2.5439, 2.5977, 2.6567, 2.7227, 2.7953, 2.8747, 2.9622, 3.0576, 3.1624, 3.2763, 3.4012, 3.5369, 3.6849, 3.8466, 4.0234, 4.2169, 4.4286, 4.6611, 4.917, 5.1985, 5.5096, 5.8532, 6.2339, 6.6541, 7.1205, 7.6363, 8.2068, 8.834, 9.5207, 10.2662, 11.0636, 11.901, 12.7583, 13.6009, 14.3928, 15.085, 15.6375, 16.0228, 16.2275, 16.2628, 16.1571, 15.943, 15.6579, 15.333, 14.9924, 14.653, 14.3278, 14.0233, 13.7433, 13.4886, 13.2589, 13.0545, 12.872, 12.7104, 12.5679, 12.441, 12.3308, 12.2329, 12.1478, 12.0725, 12.0063, 11.9474, 11.8949, 11.8496, 11.8085, 11.7726, 11.7389, 11.7091, 11.6818, 11.6559, 11.6317, 11.6086, 11.5858, 11.563, 11.5404, 11.5174, 11.4918, 11.4661, 11.4369, 11.4057, 11.3715, 11.3338, 11.2914, 11.2441]
        };

    function getClosestLevel(level, positions) {
        const availableLevels = Object.keys(positions).map(Number);
        let closestLevel = availableLevels[0];
        for (let i = 1; i < availableLevels.length; i++) {
            if (Math.abs(level - availableLevels[i]) < Math.abs(level - closestLevel)) {
                closestLevel = availableLevels[i];
            }
        }
        return closestLevel;
    }

    // Helper function to convert to dB
    function convertToDb(magnitudeArray) {
        return magnitudeArray.map(value => 20 * Math.log10(value));
    }

    // Convert all position datasets to dB
    [LevelPositions].forEach((positions) => {
        Object.keys(positions).forEach((key) => {
            positions[key] = convertToDb(positions[key]);
        });
    });

function renderGraph(Level) {
    Plotly.newPlot('graph', [
        { x: frequency, y: LevelPositions[Level], type: 'scatter', mode: 'lines', name: `Level @ ${Level}%` }
    ], {
        title: {
            text: `<a href='https://rhpfelectronics.com/rhpf-electronics-handmade-guitar-pedals-in-switzerland/rhpf-nerd-lab/' target='_blank'>RhPf Electronics</a> - Fortin Grind - Level: ${Level}%`,
            font: {
                size: 8 // Adjust title font size here
            }
        },
        xaxis: {
            title: {
                text: 'Frequency (Hz)',
                font: { size: 8 } // Adjust x-axis title font size if needed
            },
            type: 'log',
            tickvals: [20, 32, 64, 128, 256, 512, 1000, 2000, 4000, 8000, 16000, 20000],
            ticktext: ["20", "32", "64", "128", "256", "512", "1k", "2k", "4k", "8k", "16k", "20k"]
        },
        yaxis: {
            title: {
                text: 'Gain (dB)',
                font: { size: 8 } // Adjust y-axis title font size if needed
            },
            range: [-30, 30] // Fixed Y-axis range
        },
        legend: {
            font: {
                size: 8 // Adjust legend font size here
            }
        }
    });
}

    function updatePointer(pointerId, angle) {
        const pointer = document.getElementById(pointerId);
        pointer.setAttribute('transform', `rotate(${angle} 0 0)`);
    }

    const knobs = {
        Level: { element: document.getElementById('knob-Level'), pointerId: 'Level-pointer', angle: 0, positions: LevelPositions },
    };

    function updateKnob(knob, delta, pointerId, positions, setAngle) {
        knob.angle += delta;
        knob.angle = Math.max(-135, Math.min(135, knob.angle)); // Clamp angle
        const value = Math.round(((knob.angle + 135) / 270) * 100);
        setAngle(knob.angle);
        updatePointer(pointerId, knob.angle);

        // Update graph with all knob values
        const levels = Object.keys(knobs).reduce((acc, key) => {
            acc[key] = getClosestLevel(
                Math.round(((knobs[key].angle + 135) / 270) * 100),
                knobs[key].positions
            );
            return acc;
        }, {});

        renderGraph(levels.Level);
    }

function addKnobListeners(knobKey) {
    const knob = knobs[knobKey];
    const { element, pointerId, positions } = knob;

    // Handle both mouse and touch start
    const startEvent = (event) => {
        const isTouch = event.type === "touchstart";
        const clientX = isTouch ? event.touches[0].clientX : event.clientX;
        const clientY = isTouch ? event.touches[0].clientY : event.clientY;

        const rect = element.getBoundingClientRect();
        const cx = rect.left + rect.width / 2;
        const cy = rect.top + rect.height / 2;

        const moveEvent = (e) => {
            const moveClientX = isTouch ? e.touches[0].clientX : e.clientX;
            const moveClientY = isTouch ? e.touches[0].clientY : e.clientY;
            const dx = moveClientX - cx;
            const dy = moveClientY - cy;
            const deltaAngle = Math.atan2(dy, dx) * (180 / Math.PI) + 90 - knob.angle;
            updateKnob(knob, deltaAngle, pointerId, positions, (angle) => (knob.angle = angle));
        };

        const endEvent = () => {
            document.removeEventListener(isTouch ? "touchmove" : "mousemove", moveEvent);
            document.removeEventListener(isTouch ? "touchend" : "mouseup", endEvent);
        };

        document.addEventListener(isTouch ? "touchmove" : "mousemove", moveEvent);
        document.addEventListener(isTouch ? "touchend" : "mouseup", endEvent);
    };

    // Add event listeners for mouse and touch
    element.addEventListener("mousedown", startEvent);
    element.addEventListener("touchstart", startEvent, { passive: false }); // Passive false to prevent scrolling

    // Scroll wheel functionality
    element.addEventListener("wheel", (event) => {
        event.preventDefault();
        const delta = event.deltaY > 0 ? -5 : 5; // Scroll direction adjusts knob
        const deltaAngle = delta * (270 / 100); // Map delta to angle
        updateKnob(knob, deltaAngle, pointerId, positions, (angle) => (knob.angle = angle));
    });
}

// Add event listeners to all knobs
Object.keys(knobs).forEach(addKnobListeners);

// Initialize pointers
Object.keys(knobs).forEach((key) => {
    updatePointer(knobs[key].pointerId, knobs[key].angle);
});

    // Initialize graph
    renderGraph(50);
</script>
</body>
</html>
