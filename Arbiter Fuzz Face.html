<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RhPf Electronics Arbiter Fuzz Face Analysis</title>
    <meta name="description" content="Interactive analysis tool for the Arbiter Fuzz Face.">
    <meta name="author" content="RhPf Electronics">
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script>
        if (!window.Plotly) {
            document.write('<script src="/path-to-local-plotly/plotly-latest.min.js"><\/script>');
        }
    </script>
    <style>
        body {
            display: flex;
            flex-direction: row; /* Stack pedal and graph horizontally */
            justify-content: left;
            align-items: top;
            margin: 0;
            height: auto;
        }
html, body {
  overflow-y: hidden; /* no vertical scrollbar */
  overflow-x: auto;   /* allow horizontal if ever needed */
}

        #pedal-container {
            width: 100%; /* Scale pedal container to fit the viewport */
            height: 100vh; /* Maintain aspect ratio */
            margin: 0;
        }

        #pedal-svg {
            width: 100%; /* Make the SVG scale with the container */
            height: 100vh; /* Maintain aspect ratio */
            margin: 0;
        }

        #graph {
            width: 100%; /* Take up most of the width */
            height: 100vh; /* Dynamically scale height relative to the viewport */
            margin: 0; /* Add some spacing between graph and pedal */
        }
.share-btn{
  position:fixed; top:12px; left:12px; z-index:9999;
  padding:8px 12px; border:0; border-radius:10px; cursor:pointer;
  font: 600 14px/1.2 system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  background:#00796B; color:#fff; box-shadow:0 2px 8px rgba(0,0,0,.15);
}
.share-btn:hover{ filter:brightness(1.1); }

.embed-modal[hidden]{ display:none; }
.embed-modal{
  position:fixed; inset:0; z-index:10000;
  background:rgba(0,0,0,.45);
  display:flex; align-items:center; justify-content:center;
}
.embed-card{
  background:#fff; color:#111; width:min(92vw,720px);
  border-radius:14px; padding:16px; box-shadow:0 10px 30px rgba(0,0,0,.25);
  font: 14px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
}
.embed-pre{
  background:#f6f6f6; border-radius:8px; padding:10px; margin:8px 0 12px;
  white-space:pre-wrap; word-break:break-all;
}
.embed-actions{ display:flex; gap:8px; }
.embed-actions > button{
  padding:8px 12px; border:0; border-radius:8px; cursor:pointer;
  background:#111; color:#fff;
}
.embed-actions > button:nth-child(2){ background:#e2e2e2; color:#111; }

    </style>
</head>
<body>
    <!-- Pedal with Knobs -->
    <div id="pedal-container">
        <svg id="pedal-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1884 3600">
            <!-- Background Image -->
            <image href="https://thomasbe86.github.io/plotly-plot/Arbiter%20Fuzz%20Face.png" x="0" y="0" width="1884" height="3600" />
<g id="knob-fuzz" transform="translate(1470, 1300)">
    <circle cx="0" cy="0" r="170" fill="#000" stroke="none" stroke-width="3" />
    <line id="fuzz-pointer" x1="0" y1="0" x2="0" y2="-150" stroke="#ffffff" stroke-width="15" stroke-linecap="round" />
</g>

<g id="knob-volume" transform="translate(470, 1300)">
    <circle cx="0" cy="0" r="170" fill="#000" stroke="none" stroke-width="3" />
    <line id="volume-pointer" x1="0" y1="0" x2="0" y2="-150" stroke="#ffffff" stroke-width="15" stroke-linecap="round" />
</g>
        </svg>
    </div>

    <!-- Graph -->
    <div id="graph"></div>

    <script>
        // Ensure Plotly resizes with window changes
        window.addEventListener('resize', () => {
            Plotly.Plots.resize(document.getElementById('graph'));
        });
    </script>

    <script>
        // Frequency Data
        const frequency = [
  20.0, 25.1785, 31.6979, 39.9052, 50.2377, 63.2456, 79.6214, 100.2374, 126.1915, 158.8656,
  200.0, 251.7851, 316.9786, 399.0525, 502.3773, 632.4555, 796.2143, 1002.3745, 1261.9147, 1588.6565,
  2000.0, 2517.8508, 3169.7864, 3990.5246, 5023.7729, 6324.5553, 7962.1434, 10023.7447, 12619.1469, 15886.5647,
  20000.0
        ];

let sweepData = [];
const knobState = {
    "fuzz": 5,
    "volume": 5
};

// Convert angle to value index (0 to 10)
function angleToIndex(angle) {
    const clamped = Math.max(-135, Math.min(135, angle));
    return Math.round(((clamped + 135) / 270) * 10); // 0 to 10
}




function loadDatasetAndPlot() {
    const datasetURL = `https://thomasbe86.github.io/plotly-plot/Arbiter%20Fuzz%20Face.json`;
    fetch(datasetURL)
        .then(res => {
            if (!res.ok) throw new Error("HTTP status " + res.status);
            return res.json();
        })
        .then(data => {
            sweepData = data;
            updatePlot();
        })
        .catch(err => {
            console.error("Error fetching or parsing JSON:", err);
        });
}


function updatePlot() {
    const fuzzValue = knobState.fuzz;
    const volumeValue = knobState.volume;

    const match = sweepData.find(entry =>
        entry.positions.fuzz === fuzzValue &&
        entry.positions.volume === volumeValue
    );

    if (!match) {
        console.warn("No matching data for", knobState);
        return;
    }

const plotData = [{
    x: frequency,
    y: match.data,
    type: 'scatter',
    mode: 'lines',
    name: `Combined @ Fuzz: ${fuzzValue}, Volume: ${volumeValue}`,
    line: {
        color: 'red',
        width: 3,
        shape: 'spline'  // <--- This smooths the line
    }
}];

    Plotly.newPlot('graph', plotData, {
        title: {
            text: `<a href='https://rhpfelectronics.com/rhpf-electronics-handmade-guitar-pedals-in-switzerland/rhpf-nerd-lab/' target='_blank'>RhPf Electronics</a> – Arbiter Fuzz Face Analysis – Fuzz: ${fuzzValue} | Volume: ${volumeValue}`,
            font: { size: 8 }
        },
        xaxis: {
            title: {
                text: 'Frequency (Hz)',
                font: { size: 8 }
            },
            type: 'log',
            tickvals: [20, 32, 64, 128, 256, 512, 1000, 2000, 4000, 8000, 16000, 20000],
            ticktext: ["20", "32", "64", "128", "256", "512", "1k", "2k", "4k", "8k", "16k", "20k"]
        },
        yaxis: {
            title: {
                text: 'Gain (dB)',
                font: { size: 8 }
            },
            range: [-30, 60] // You can adjust based on your sweep data
        },
        legend: {
            font: { size: 8 }
        },
        margin: { t: 40, l: 50, r: 20, b: 50 }
    });
}


function updatePointer(pointerId, angle) {
    document.getElementById(pointerId).setAttribute('transform', `rotate(${angle} 0 0)`);
}

const knobs = {
    fuzz: { element: document.getElementById('knob-fuzz'), pointerId: 'fuzz-pointer', angle: 0 },
    volume: { element: document.getElementById('knob-volume'), pointerId: 'volume-pointer', angle: 0 },
};

function updateKnob(knobKey, angle) {
    const knob = knobs[knobKey];
    knob.angle = angle;
    updatePointer(knob.pointerId, angle);
    knobState[knobKey] = angleToIndex(angle);
    updatePlot();
}

function addKnobListeners(knobKey) {
    const knob = knobs[knobKey];
    const { element } = knob;

    const startEvent = (event) => {
        event.preventDefault();
        const isTouch = event.type === "touchstart";
        const clientX = isTouch ? event.touches[0].clientX : event.clientX;
        const clientY = isTouch ? event.touches[0].clientY : event.clientY;

        const rect = element.getBoundingClientRect();
        const cx = rect.left + rect.width / 2;
        const cy = rect.top + rect.height / 2;

const moveEvent = (e) => {
    const moveClientX = isTouch ? e.touches[0].clientX : e.clientX;
    const moveClientY = isTouch ? e.touches[0].clientY : e.clientY;
    const dx = moveClientX - cx;
    const dy = moveClientY - cy;

    let angle = Math.atan2(dy, dx) * (180 / Math.PI); // Full -180 to 180
    angle = angle < -135 ? -135 : angle > 135 ? 135 : angle; // Clamp to knob range

    // Update rotation and knob logic
    updateKnob(knobKey, angle);

};


        const endEvent = () => {
            document.removeEventListener(isTouch ? "touchmove" : "mousemove", moveEvent);
            document.removeEventListener(isTouch ? "touchend" : "mouseup", endEvent);
        };

        document.addEventListener(isTouch ? "touchmove" : "mousemove", moveEvent);
        document.addEventListener(isTouch ? "touchend" : "mouseup", endEvent);
    };

    element.addEventListener("mousedown", startEvent);
    element.addEventListener("touchstart", startEvent, { passive: false });

    element.addEventListener("wheel", (event) => {
        event.preventDefault();
        const delta = event.deltaY > 0 ? -15 : 15;
        let newAngle = knob.angle + delta;
        newAngle = Math.max(-135, Math.min(135, newAngle));
        updateKnob(knobKey, newAngle);
    });
}

// Init
Object.keys(knobs).forEach(k => {
    updatePointer(knobs[k].pointerId, knobs[k].angle);
    addKnobListeners(k);
});
loadDatasetAndPlot();
</script>
<!-- Share / Embed UI -->
<button id="shareBtn" class="share-btn" aria-haspopup="dialog">Share / Embed</button>

<div id="embedModal" class="embed-modal" role="dialog" aria-modal="true" hidden>
  <div class="embed-card">
    <h3 style="margin-top:0">Embed this tool</h3>
    <p>Copy–paste this into your website:</p>
    <pre id="embedCode" class="embed-pre"></pre>
    <div class="embed-actions">
      <button id="copyEmbed">Copy</button>
      <button id="closeModal">Close</button>
    </div>
    <p style="font-size:12px;opacity:.8;margin:8px 0 0">
      Tip: In WordPress, use a “Custom HTML” block and paste the code.
    </p>
  </div>
</div>
<script>
  // 1) The URL others should embed (your current page)
  const EMBED_URL = "https://thomasbe86.github.io/plotly-plot/Arbiter%20Fuzz%20Face.html";

  // 2) The iframe code we’ll offer people to copy
  const EMBED_IFRAME = `<iframe src="${EMBED_URL}" style="width:100%;height:700px;border:0;" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>`;

  // 3) Simple modal logic + clipboard copy
  const $btn = document.getElementById('shareBtn');
  const $modal = document.getElementById('embedModal');
  const $pre = document.getElementById('embedCode');
  const $copy = document.getElementById('copyEmbed');
  const $close = document.getElementById('closeModal');

  $btn.addEventListener('click', () => {
    $pre.textContent = EMBED_IFRAME;
    $modal.hidden = false;
  });

  $close.addEventListener('click', () => { $modal.hidden = true; });

  $copy.addEventListener('click', async () => {
    try {
      await navigator.clipboard.writeText($pre.textContent);
      $copy.textContent = "Copied!";
      setTimeout(() => $copy.textContent = "Copy", 1200);
    } catch (e) {
      // fallback
      const r = document.createRange();
      r.selectNode($pre);
      const sel = window.getSelection();
      sel.removeAllRanges(); sel.addRange(r);
      const ok = document.execCommand('copy');
      sel.removeAllRanges();
      alert(ok ? "Copied!" : "Copy failed. Please copy manually.");
    }
  });

  // (optional) ESC to close
  window.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && !$modal.hidden) $modal.hidden = true;
  });
</script>

</body>
</html>